# CLAUDE.md

本ファイルは、このリポジトリ内のコードをClaude Code（claude.ai/code）で処理する際のガイドラインを提供します。

## プロジェクト概要

本プロジェクトはPythonで実装されたアプリケーションで、日本の賃金および賞与収入をグローバル株式指数（ACWI）に投資した場合の内部収益率（IRR）を算出します。日本のe-Stat APIから賃金データを、Yahoo Financeから株式リターンデータを取得して処理します。

### プロジェクトの目的（docs/tasks.mdより）
- **資産形成格差の分析**：就業開始年ごとの資産形成状況の差異を明らかにする（例：2010-2018年期間は高IRR、2005-2010年期間は低IRRなど）
- **実質賃金とIRRの比較**：実際の賃金上昇率と投資リターンを比較する
- **月次進捗分析**：各開始年からの月次IRR推移を算出し、異なる開始年間での比較を可能にする
- **包括的な出力**：結果をテーブル形式（YAML形式）で生成し、詳細なレポートを作成する
- **データ形式の標準化**：すべての入出力データをYAML形式で扱う

## コマンド

### 開発用コマンド
```bash
# 依存関係のインストール
pip install -r requirements.txt

# メインスクリプトの実行
python src/fetch_and_compute_irr.py
```

### 環境設定
- `ESTAT_APP_ID`環境変数を設定し、賃金データ取得用のe-Stat APIキーを割り当てる
- スクリプト実行には外部APIからデータを取得するためのインターネット接続が必要

## アーキテクチャ

### 主要コンポーネント
- **src/fetch_and_compute_irr.py**：データ取得、処理、IRR計算の全ロジックを含むメインスクリプト
  - `fetch_estat()`：日本のe-Stat APIから賃金/賞与データを取得
  - `fetch_world_returns()`：Yahoo FinanceからACWI株式データをダウンロード
  - `irr()`：二分探索法を用いた独自のIRR計算関数
  - `main()`：データ処理パイプライン全体を統括するメイン関数

### データフロー
1. e-Stat APIから複数産業の賃金・賞与データを取得
2. Yahoo Financeから2004-2016年期間のグローバル株式リターンデータ（ACWI）をダウンロード
3. 各産業および開始年ごとに、賃金＋賞与/12を毎月投資した場合のシナリオをシミュレーション
4. 各投資シナリオについてIRRを算出
5. 結果をCSV形式で出力

### データ構造
```
data/
├── raw/           # ダウンロードした生データ（git管理対象外）
│   ├── wage_bonus.yml
│   └── world_stock.csv
└── processed/     # 生成された処理結果データ（requirementsに従いYAML形式とする）
    └── irr_results.csv
docs/
└── tasks.md       # プロジェクト要件と目的（日本語）
```

### 分析対象産業
- 全体平均（産業計）
- 金融サービス（J 金融業，保険業）
- 鉱業（C 鉱業，採石業，砂利採取業）
- 情報通信業（G 情報通信業）
- 製造業（E 製造業）

## 依存ライブラリ
- **pandas**：データ操作およびCSVファイル処理
- **requests**：e-Stat APIへのHTTPリクエスト送信
- **yfinance**：Yahoo Financeからの株式データ取得
- **PyYAML**：生データの保存用YAMLファイル処理

## 今後の開発予定
docs/tasks.mdに記載された要件に基づき、以下の機能追加が必要です：
- 出力形式をCSVからYAML形式に変換
- 月次IRR推移の計算機能を追加
- 異なる開始年間の比較分析機能を実装
- 実質賃金上昇率とIRRの比較機能を追加
- 資産形成格差分析のためのレポート機能を強化

## GitHub Actions
ワークフローファイル（`.github/workflows/irr.yml`）により、プッシュ時およびworkflow_dispatch時にスクリプトが自動実行され、結果がアーティファクトとしてアップロードされます。このワークフローを実行するには、リポジトリ内で`ESTAT_APP_ID`シークレットを設定する必要があります。
